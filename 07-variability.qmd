---
title: "Section 7: Expressing Variability"
format: html
---

## Section 7.2

```{r}
library(tidyverse)
library(here)
statsurvey_df <- read_csv(here("data/stat113_survey.csv"))
statsurvey_df <- statsurvey_df |>
  mutate(time_year = as.numeric(time_year)) |>
  mutate(academic_year = if_else(time_semester == "S",
                                 true = time_year - 1,
                                 false = time_year)) |>
  relocate(academic_year)
statsurvey_nomiss <- statsurvey_df |>
  filter(GPA <= 4) |>
  filter(!is.na(GPA))

stat_sum <- statsurvey_nomiss |>
  group_by(academic_year) |>
  summarise(mean_gpa = mean(GPA),
            sd_gpa = sd(GPA),
            n_students = n()) |>
  mutate(se = sd_gpa / sqrt(n_students),
         lb_se = mean_gpa - se,
         ub_se = mean_gpa + se) |>
  mutate(academic_year = academic_year + 2000)

ggplot(data = stat_sum, aes(x = academic_year,
                            y = mean_gpa)) +
  geom_errorbar(aes(ymin = lb_se,
                    ymax = ub_se),
                colour = "#E42B1C") +
  geom_point() +
  theme_minimal()

```

## Your Turn

```{r}
statsurvey_df |> group_by(academic_year) |>
  summarise(mean(!is.na(Tattoo)))

survey_tattoo <- statsurvey_df |>
  filter(!is.na(Tattoo))
tattoo_plot <- survey_tattoo |> group_by(academic_year, Tattoo) |>
  summarise(n_students = n()) |>
  ungroup() |>
  pivot_wider(names_from = Tattoo, values_from = n_students) |>
  mutate(n = No + Yes) |>
  mutate(samp_prop = Yes / n,
         se = sqrt(samp_prop * (1 - samp_prop) / n),
         lb = samp_prop - se,
         ub = samp_prop + se)
ggplot(data = tattoo_plot, aes(x = academic_year,
                               y = samp_prop)) +
  geom_errorbar(aes(ymin = lb, ymax = ub)) +
  geom_point() +
  theme_minimal()
```